{% extends 'base.html' %}
{% load static %}

{% block title %}Preferences{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">Preferences</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active" aria-current="page">
                    Settings
                </li>
            </ol>
        </nav>
    </div>
</div>

{% include 'partials/_messages.html' %}

<!-- Settings Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin: 0 32px;">
    
    <!-- Currency Settings -->
    <div class="modern-card fade-in">
        <div class="card-header-modern">
            <h3 class="card-title-modern">
                <i class="fas fa-dollar-sign"></i> Currency Settings
            </h3>
        </div>
        
        <form method="post" action="{% url 'preferences' %}">
            {% csrf_token %}
            <div class="form-group" style="margin-bottom: 24px;">
                <label for="currency" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                    Default Currency
                </label>
                <select class="form-control" 
                        name="currency"
                        id="currency"
                        style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease; background: white;">
                    <option value="USD" {% if user_preferences.currency == 'USD' or not user_preferences.currency %}selected{% endif %}>USD - US Dollar ($)</option>
                    <option value="EUR" {% if user_preferences.currency == 'EUR' %}selected{% endif %}>EUR - Euro (€)</option>
                    <option value="GBP" {% if user_preferences.currency == 'GBP' %}selected{% endif %}>GBP - British Pound (£)</option>
                    <option value="INR" {% if user_preferences.currency == 'INR' %}selected{% endif %}>INR - Indian Rupee (₹)</option>
                    <option value="JPY" {% if user_preferences.currency == 'JPY' %}selected{% endif %}>JPY - Japanese Yen (¥)</option>
                    <option value="CAD" {% if user_preferences.currency == 'CAD' %}selected{% endif %}>CAD - Canadian Dollar (C$)</option>
                    <option value="AUD" {% if user_preferences.currency == 'AUD' %}selected{% endif %}>AUD - Australian Dollar (A$)</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 24px;">
                <label for="language" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                    Language
                </label>
                <select class="form-control" 
                        name="language"
                        id="language"
                        style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease; background: white;">
                    <option value="en" {% if user_preferences.language == 'en' or not user_preferences.language %}selected{% endif %}>English</option>
                    <option value="es" {% if user_preferences.language == 'es' %}selected{% endif %}>Español</option>
                    <option value="fr" {% if user_preferences.language == 'fr' %}selected{% endif %}>Français</option>
                    <option value="de" {% if user_preferences.language == 'de' %}selected{% endif %}>Deutsch</option>
                    <option value="it" {% if user_preferences.language == 'it' %}selected{% endif %}>Italiano</option>
                </select>
            </div>
            
            <button type="submit" class="btn-primary-modern">
                <i class="fas fa-save"></i> Save Preferences
            </button>
        </form>
    </div>
    
    <!-- Notification Settings -->
    <div class="modern-card fade-in">
        <div class="card-header-modern">
            <h3 class="card-title-modern">
                <i class="fas fa-bell"></i> Notifications
            </h3>
        </div>
        
        <form method="post" action="{% url 'preferences' %}">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="notifications">
            
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border-color);">
                    <div>
                        <h4 style="margin: 0; font-size: 14px; font-weight: 600; color: var(--text-dark);">Email Notifications</h4>
                        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-gray);">Receive expense summaries via email</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="email_notifications" {% if user_preferences.email_notifications %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border-color);">
                    <div>
                        <h4 style="margin: 0; font-size: 14px; font-weight: 600; color: var(--text-dark);">Budget Alerts</h4>
                        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-gray);">Get notified when approaching budget limits</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="budget_alerts" {% if user_preferences.budget_alerts %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0;">
                    <div>
                        <h4 style="margin: 0; font-size: 14px; font-weight: 600; color: var(--text-dark);">Goal Reminders</h4>
                        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-gray);">Reminders to update goal progress</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="goal_reminders" {% if user_preferences.goal_reminders %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <button type="submit" class="btn-primary-modern">
                <i class="fas fa-save"></i> Save Notification Settings
            </button>
        </form>
    </div>
    
    <!-- Display Settings -->
    <div class="modern-card fade-in">
        <div class="card-header-modern">
            <h3 class="card-title-modern">
                <i class="fas fa-palette"></i> Display
            </h3>
        </div>
        
        <div style="margin-bottom: 24px;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                Theme
            </label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <button type="button" class="theme-option active" data-theme="light" style="padding: 16px; border: 2px solid var(--primary-color); border-radius: var(--radius-md); background: white; cursor: pointer; text-align: center;">
                    <i class="fas fa-sun" style="font-size: 24px; color: var(--primary-color); margin-bottom: 8px; display: block;"></i>
                    <span style="font-size: 14px; font-weight: 600;">Light</span>
                </button>
                <button type="button" class="theme-option" data-theme="dark" style="padding: 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); background: white; cursor: pointer; text-align: center;">
                    <i class="fas fa-moon" style="font-size: 24px; color: var(--text-gray); margin-bottom: 8px; display: block;"></i>
                    <span style="font-size: 14px; font-weight: 600;">Dark</span>
                </button>
            </div>
        </div>
        
        <div style="margin-bottom: 24px;">
            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                Date Format
            </label>
            <select class="form-control" style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; background: white;">
                <option>MM/DD/YYYY</option>
                <option>DD/MM/YYYY</option>
                <option>YYYY-MM-DD</option>
            </select>
        </div>
        
        <button type="button" class="btn-primary-modern">
            <i class="fas fa-save"></i> Save Display Settings
        </button>
    </div>
    
    <!-- Data Management -->
    <div class="modern-card fade-in">
        <div class="card-header-modern">
            <h3 class="card-title-modern">
                <i class="fas fa-database"></i> Data Management
            </h3>
        </div>
        
        <div style="margin-bottom: 24px;">
            <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: var(--text-dark);">Export Data</h4>
            <p style="font-size: 14px; color: var(--text-gray); margin-bottom: 16px;">Download your expense and income data</p>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="btn-secondary-modern">
                    <i class="fas fa-file-csv"></i> Export CSV
                </button>
                <button class="btn-secondary-modern">
                    <i class="fas fa-file-pdf"></i> Export PDF
                </button>
            </div>
        </div>
        
        <div style="margin-bottom: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">
            <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #dc3545;">Danger Zone</h4>
            <p style="font-size: 14px; color: var(--text-gray); margin-bottom: 16px;">Permanently delete all your data</p>
            <button class="btn-secondary-modern" style="background: #dc3545; color: white; border-color: #dc3545;" onclick="confirmDataDelete()">
                <i class="fas fa-trash"></i> Delete All Data
            </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteDataModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
    <div style="background: white; padding: 32px; border-radius: var(--radius-lg); max-width: 400px; text-align: center;">
        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #dc3545; margin-bottom: 16px;"></i>
        <h3 style="margin-bottom: 16px; color: var(--text-dark);">Delete All Data?</h3>
        <p style="margin-bottom: 24px; color: var(--text-gray);">This will permanently delete all your expenses, income, and goals. This action cannot be undone.</p>
        <div style="display: flex; gap: 16px; justify-content: center;">
            <button onclick="closeDeleteDataModal()" class="btn-secondary-modern">Cancel</button>
            <button onclick="deleteAllData()" class="btn-primary-modern" style="background: #dc3545; border-color: #dc3545;">
                <i class="fas fa-trash"></i> Delete Everything
            </button>
        </div>
    </div>
</div>

<style>
.form-control:focus {
    outline: none;
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 3px rgba(75, 63, 255, 0.1) !important;
}

.theme-option.active {
    border-color: var(--primary-color) !important;
}

.theme-option.active i {
    color: var(--primary-color) !important;
}

/* Toggle Switch Styles */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--border-color);
    transition: .4s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: var(--primary-color);
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

@media (max-width: 768px) {
    div[style*="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr))"] {
        grid-template-columns: 1fr !important;
        margin: 0 16px !important;
    }
}
</style>

<script>
// Theme selection
document.querySelectorAll('.theme-option').forEach(option => {
    option.addEventListener('click', function() {
        document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
        this.classList.add('active');
    });
});

function confirmDataDelete() {
    document.getElementById('deleteDataModal').style.display = 'flex';
}

function closeDeleteDataModal() {
    document.getElementById('deleteDataModal').style.display = 'none';
}

function deleteAllData() {
    // Add your delete logic here
    alert('Data deletion functionality would be implemented here');
    closeDeleteDataModal();
}
</script>

{% endblock content %}