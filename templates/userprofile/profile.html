{% extends 'base.html' %}
{% load static %}

{% block title %}Profile{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">My Profile</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active" aria-current="page">
                    Account
                </li>
            </ol>
        </nav>
    </div>
</div>

{% include 'partials/_messages.html' %}

<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 32px; margin: 0 32px;">
    
    <!-- Profile Card -->
    <div class="modern-card fade-in">
        <div style="text-align: center; margin-bottom: 24px;">
            <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 48px; color: white; font-weight: 700;">
                {{user.username|slice:":1"|upper}}
            </div>
            <h2 style="margin: 0 0 8px; color: var(--text-dark);">{{user.get_full_name|default:user.username}}</h2>
            <p style="margin: 0; color: var(--text-gray); font-size: 14px;">{{user.email}}</p>
        </div>
        
        <div style="padding: 20px 0; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span style="color: var(--text-gray); font-size: 14px;">Member since</span>
                <span style="color: var(--text-dark); font-weight: 600; font-size: 14px;">{{user.date_joined|date:"M Y"}}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span style="color: var(--text-gray); font-size: 14px;">Last login</span>
                <span style="color: var(--text-dark); font-weight: 600; font-size: 14px;">{{user.last_login|date:"M d, Y"}}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-gray); font-size: 14px;">Status</span>
                <span style="color: var(--success-color); font-weight: 600; font-size: 14px;">
                    <i class="fas fa-circle" style="font-size: 8px; margin-right: 4px;"></i>
                    Active
                </span>
            </div>
        </div>
        
        <div style="margin-top: 20px;">
            <button class="btn-secondary-modern" style="width: 100%; margin-bottom: 12px;">
                <i class="fas fa-camera"></i> Change Avatar
            </button>
            <button class="btn-secondary-modern" style="width: 100%;" onclick="showChangePasswordModal()">
                <i class="fas fa-lock"></i> Change Password
            </button>
        </div>
    </div>
    
    <!-- Profile Form -->
    <div class="modern-card fade-in">
        <div class="card-header-modern">
            <h3 class="card-title-modern">
                <i class="fas fa-user-edit"></i> Personal Information
            </h3>
        </div>
        
        <form method="post">
            {% csrf_token %}
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                <div class="form-group">
                    <label for="first_name" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                        First Name
                    </label>
                    <input type="text" 
                           class="form-control" 
                           name="first_name" 
                           id="first_name"
                           value="{{user.first_name}}" 
                           placeholder="Enter first name"
                           style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease;" />
                </div>
                
                <div class="form-group">
                    <label for="last_name" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                        Last Name
                    </label>
                    <input type="text" 
                           class="form-control" 
                           name="last_name" 
                           id="last_name"
                           value="{{user.last_name}}" 
                           placeholder="Enter last name"
                           style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease;" />
                </div>
            </div>
            
            <div class="form-group" style="margin-bottom: 24px;">
                <label for="email" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                    Email Address
                </label>
                <input type="email" 
                       class="form-control" 
                       name="email" 
                       id="email"
                       value="{{user.email}}" 
                       placeholder="Enter email address"
                       style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease;" />
            </div>
            
            <div class="form-group" style="margin-bottom: 24px;">
                <label for="username" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                    Username
                </label>
                <input type="text" 
                       class="form-control" 
                       name="username" 
                       id="username"
                       value="{{user.username}}" 
                       placeholder="Enter username"
                       style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease;" />
            </div>
            
            <div class="form-group" style="margin-bottom: 32px;">
                <label for="bio" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">
                    Bio (Optional)
                </label>
                <textarea class="form-control" 
                          name="bio" 
                          id="bio"
                          rows="4"
                          placeholder="Tell us about yourself..."
                          style="padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px; transition: all 0.3s ease; resize: vertical;">{{user.profile.bio|default:""}}</textarea>
            </div>
            
            <div style="display: flex; gap: 16px; justify-content: flex-end;">
                <button type="button" class="btn-secondary-modern" onclick="resetForm()">
                    <i class="fas fa-undo"></i> Reset
                </button>
                <button type="submit" class="btn-primary-modern">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Account Statistics -->
<div class="modern-card fade-in" style="margin: 32px 32px 0;">
    <div class="card-header-modern">
        <h3 class="card-title-modern">
            <i class="fas fa-chart-bar"></i> Account Statistics
        </h3>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-wallet" style="font-size: 32px; color: var(--primary-color); margin-bottom: 12px;"></i>
            <div style="font-size: 24px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px;">0</div>
            <div style="font-size: 14px; color: var(--text-gray);">Total Expenses</div>
        </div>
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-dollar-sign" style="font-size: 32px; color: var(--success-color); margin-bottom: 12px;"></i>
            <div style="font-size: 24px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px;">0</div>
            <div style="font-size: 14px; color: var(--text-gray);">Total Income</div>
        </div>
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-bullseye" style="font-size: 32px; color: var(--accent-color); margin-bottom: 12px;"></i>
            <div style="font-size: 24px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px;">0</div>
            <div style="font-size: 14px; color: var(--text-gray);">Active Goals</div>
        </div>
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-calendar" style="font-size: 32px; color: var(--primary-light); margin-bottom: 12px;"></i>
            <div style="font-size: 24px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px;">{{user.date_joined|timesince}}</div>
            <div style="font-size: 14px; color: var(--text-gray);">Member For</div>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div id="passwordModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
    <div style="background: white; padding: 32px; border-radius: var(--radius-lg); max-width: 400px; width: 90%;">
        <h3 style="margin-bottom: 24px; color: var(--text-dark);">Change Password</h3>
        <form id="passwordForm" method="post">
            {% csrf_token %}
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Current Password</label>
                <input type="password" name="current_password" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-md);">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">New Password</label>
                <input type="password" name="new_password" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-md);">
            </div>
            <div style="margin-bottom: 24px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Confirm New Password</label>
                <input type="password" name="confirm_password" required style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-md);">
            </div>
            <div style="display: flex; gap: 16px; justify-content: flex-end;">
                <button type="button" onclick="closePasswordModal()" class="btn-secondary-modern">Cancel</button>
                <button type="submit" class="btn-primary-modern">Change Password</button>
            </div>
        </form>
    </div>
</div>

<style>
.form-control:focus {
    outline: none;
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 3px rgba(75, 63, 255, 0.1) !important;
}

@media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 2fr"] {
        grid-template-columns: 1fr !important;
        margin: 0 16px !important;
    }
    
    div[style*="grid-template-columns: 1fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
function showChangePasswordModal() {
    document.getElementById('passwordModal').style.display = 'flex';
}

function closePasswordModal() {
    document.getElementById('passwordModal').style.display = 'none';
}

function resetForm() {
    if (confirm('Reset all changes?')) {
        location.reload();
    }
}
</script>

{% endblock content %}